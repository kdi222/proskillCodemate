{"version":3,"file":"reviewapprover.min.js","sources":["../src/reviewapprover.js"],"sourcesContent":["/* eslint-disable promise/catch-or-return */\n/* eslint-disable no-console*/\n/* eslint-disable no-trailing-spaces*/\n/* eslint-disable no-undef*/\n/* eslint-disable no-unused-vars*/\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/str',\n    'block_edwiserratingreview/jquery.dataTables',\n    'block_edwiserratingreview/dataTables.bootstrap4',\n], function ($, Ajax, ModalFactory, ModalEvents, Str) {\n\n    const SELECTOR = {\n        minDate : \"#min\",\n        maxDate : \"#max\",\n        pendingapproval : \"#pendingforapproval\",\n    };\n\n        // ****** IMPORTANT ******\n    // Do not change the sequence.\n    // If you want to add new strings here, add it at the bottom.\n    // Do not remove any string from the array.\n    // There is no way we can revert back if sequence is changed.\n    // ****** IMPORTANT ******\n    const strings = [\n        {key: 'edwiserratingreview:approvereview', component: 'block_edwiserratingreview'},\n        {key: 'edwiserratingreview:approve', component: 'block_edwiserratingreview'},\n        {key: 'edwiserratingreview:deletereview', component: 'block_edwiserratingreview'},\n        {key: 'edwiserratingreview:confirm', component: 'block_edwiserratingreview'},\n        {key: 'edwiserratingreview:unpublishreview', component: 'block_edwiserratingreview'},\n        {key: 'edwiserratingreview:movetodraft', component: 'block_edwiserratingreview'},\n    ];\n\n    var LANGS; // Gloabl variable to store languages.\n\n    // Functionality to fetch strings.\n    const fetchLanguages = () => {\n        Str.get_strings(strings).then(function(results) {\n            LANGS = results;\n            return results;\n        });\n    };\n    const getSelectedDateRange = () => {\n        return [$(SELECTOR.minDate).val(), $(SELECTOR.maxDate).val()];\n    };\n\n    const init = () => {\n        $(document).ready(function () {\n\n            var modalexist;\n            var bodycontent = '';\n            var titlecontent = '';\n            var reveiwid = '';\n            var buttontext = '';\n            fetchLanguages();\n\n\n            var table = $('#example').DataTable({\n                searching: false,\n                autoWidth: true,\n                serverSide: true,\n                // columnDefs: [ { orderable: false, targets: [0,1,2,3,4,6]} ],\n                bLengthChange: false,\n                responsive: true,\n                language: {\n                    lengthMenu: M.util.get_string('show', 'moodle') + \" _MENU_ \" + M.util.get_string('entries', 'moodle'),\n                    info: M.util.get_string('datatableinfo', 'block_edwiserratingreview'),\n                    infoEmpty:M.util.get_string('infoEmpty', 'block_edwiserratingreview'),\n                    paginate: {\n                        first: M.util.get_string('first', 'moodle'),\n                        previous: M.util.get_string('previous', 'moodle'),\n                        next: M.util.get_string('next', 'moodle'),\n                        last: M.util.get_string('last', 'moodle'),\n                    },\n                    emptyTable: M.util.get_string('emptytable', 'block_edwiserratingreview'),\n                },\n                columns: [\n                    { data: \"reviewfor\", orderable: true},\n                    { data: \"name\", orderable: false },\n                    { data: \"email\", orderable: false },\n                    { data: \"ratings\", orderable: false, className: 'e-w-75' },\n                    { data: \"review\", orderable: false},\n                    { data: \"date\" },\n                    { data: \"action\", orderable: false }\n                ],\n                ajax: function (data, callback, settings) {\n                    const [min, max] = getSelectedDateRange();\n                    var order = 'asc';\n                    Ajax.call([{\n                        methodname: 'block_edwiserratingreview_get_reviews',\n                        args: {\n                            start: data.start,\n                            length: data.length,\n                            order: (data.order[0].column == 5) ? data.order[0].dir : 'desc', // 5 for 5th column intable.\n                            mindate: min,\n                            maxdate: max,\n                            loadonlypending: $(SELECTOR.pendingapproval).is(\":checked\")\n                        },\n                        done: function(response) {\n                            callback(response);\n                        },\n                        fail: function(response) {\n                            console.log(\"failed to load\");\n                        }\n                    }]);\n                }\n            });\n\n            $(SELECTOR.minDate).keypress(function (event) { event.preventDefault(); });\n            $(SELECTOR.maxDate).keypress(function (event) { event.preventDefault(); });\n\n            $(SELECTOR.minDate).change(function () {\n                const [min, max] = getSelectedDateRange();\n\n                if (min > max && max != \"\") {\n                    // reset the max date to min value if min is higher.\n                    $(SELECTOR.maxDate).val(min);\n                }\n\n                $(SELECTOR.maxDate).attr('min', min);\n\n                table.draw();\n            });\n\n            $(SELECTOR.maxDate).change(function () {\n                table.draw();\n            });\n\n            $(SELECTOR.pendingapproval).on(\"change\", function() {\n                table.draw();\n            });\n\n            // This method is used to make ajax call for approving review.\n            var updateapprove = function (reviewid, approvevalue, approveflag) {\n                Ajax.call([{\n                    methodname: 'block_edwiserratingreview_updateapprove',\n                    args: {\n                        reviewid: reviewid,\n                        approvevalue: approvevalue,   //Value of approve field 0 or 1\n                        approveflag: approveflag     // If this field is false then review will be removed from database\n                                                    //If it is true the approve field value  updated\n                    },\n                    done: function (response) {\n                        console.log(response);\n                    },\n                    fail: function (response) {\n                        console.log(\"failed to load\");\n                    }\n                }]);\n            };\n\n            // This method will create a modal for review.\n            var approvalmodal = function (bodycontent, titlecontent, approvevalue, approvaflag, buttontext) {\n                ModalFactory.create({\n                    type: ModalFactory.types.SAVE_CANCEL,\n                    title: titlecontent,\n                    body: bodycontent,\n                })\n                    // eslint-disable-next-line promise/always-return\n                    .then(function (modal) {\n                        modalexist = modal;\n                        modal.setSaveButtonText(buttontext);\n                        var root = modal.getRoot();\n                        root.on(ModalEvents.save, function () {\n                            updateapprove(reveiwid, approvevalue, approvaflag);\n                            table.draw(\"page\");\n                        });\n                        modal.show();\n                    });\n            };\n\n            var bodydata = function (currentbtn) {\n                var currentrow = $(currentbtn).closest('tr');\n                var col0 = currentrow.find('td:eq(0)').text();\n                var col1 = currentrow.find('td:eq(1)').text();\n                var col2 = currentrow.find('td:eq(2)').text();\n                var col3 = currentrow.find('td:eq(3)').html();\n                var col4 = currentrow.find('td:eq(4)').text();\n                var col5 = currentrow.find('td:eq(5)').text();\n                return `<p>${col0}</p><p>${col1}</p><p>${col2}</p><p>${col3}</p><p>${col4}</p><p>${col5}</p>`;\n            };\n            $(document).on('click', '.reviewapprovebtn', function () {\n                bodycontent = bodydata(this);\n                // titlecontent = \"Approve review\";\n                titlecontent = LANGS[0];\n                reveiwid = $(this).attr('data-id');\n                // buttontext = 'Approve';\n                buttontext = LANGS[1];\n                approvalmodal(bodycontent, titlecontent, 1, true, buttontext);\n\n            });\n\n            $(document).on('click', '.denyapprovemodal', function () {\n                bodycontent = bodydata(this);\n                titlecontent = LANGS[4];\n                reveiwid = $(this).attr('data-id');\n                buttontext = LANGS[5];\n                approvalmodal(bodycontent, titlecontent, 0, true, buttontext);\n            });\n\n            $(document).on('click', '.instantapprove', function () {\n                updateapprove($(this).attr('data-id'), 1, true);\n                table.draw(\"page\");\n            });\n            $(document).on('click', '.deniedapproval', function () {\n                updateapprove($(this).attr('data-id'), 0, true);\n                table.draw(\"page\");\n            });\n            $(document).on('click', '.reviewremovebtn', function () {\n                bodycontent = M.util.get_string('reviewdeletewarning', 'block_edwiserratingreview');\n                titlecontent = LANGS[2];\n                reveiwid = $(this).attr('data-id');\n                buttontext = LANGS[3];\n                approvalmodal(bodycontent, titlecontent, 0, false, buttontext);\n            });\n\n        });\n    };\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","$","Ajax","ModalFactory","ModalEvents","Str","SELECTOR","strings","key","component","LANGS","getSelectedDateRange","val","init","document","ready","bodycontent","titlecontent","reveiwid","buttontext","get_strings","then","results","table","DataTable","searching","autoWidth","serverSide","bLengthChange","responsive","language","lengthMenu","M","util","get_string","info","infoEmpty","paginate","first","previous","next","last","emptyTable","columns","data","orderable","className","ajax","callback","settings","min","max","call","methodname","args","start","length","order","column","dir","mindate","maxdate","loadonlypending","is","done","response","fail","console","log","keypress","event","preventDefault","change","attr","draw","on","updateapprove","reviewid","approvevalue","approveflag","approvalmodal","approvaflag","create","type","types","SAVE_CANCEL","title","body","modal","setSaveButtonText","getRoot","save","show","bodydata","currentbtn","currentrow","closest","col0","find","text","col1","col2","col3","html","col4","col5","this"],"mappings":"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"}
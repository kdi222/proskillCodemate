define("block_edwiserratingreview/reviewapprover",["jquery","core/ajax","core/modal_factory","core/modal_events","core/str","block_edwiserratingreview/jquery.dataTables","block_edwiserratingreview/dataTables.bootstrap4"],(function($,Ajax,ModalFactory,ModalEvents,Str){const SELECTOR_minDate="#min",SELECTOR_maxDate="#max",SELECTOR_pendingapproval="#pendingforapproval",strings=[{key:"edwiserratingreview:approvereview",component:"block_edwiserratingreview"},{key:"edwiserratingreview:approve",component:"block_edwiserratingreview"},{key:"edwiserratingreview:deletereview",component:"block_edwiserratingreview"},{key:"edwiserratingreview:confirm",component:"block_edwiserratingreview"},{key:"edwiserratingreview:unpublishreview",component:"block_edwiserratingreview"},{key:"edwiserratingreview:movetodraft",component:"block_edwiserratingreview"}];var LANGS;const getSelectedDateRange=()=>[$(SELECTOR_minDate).val(),$(SELECTOR_maxDate).val()];return{init:()=>{$(document).ready((function(){var bodycontent="",titlecontent="",reveiwid="",buttontext="";Str.get_strings(strings).then((function(results){return LANGS=results,results}));var table=$("#example").DataTable({searching:!1,autoWidth:!0,serverSide:!0,bLengthChange:!1,responsive:!0,language:{lengthMenu:M.util.get_string("show","moodle")+" _MENU_ "+M.util.get_string("entries","moodle"),info:M.util.get_string("datatableinfo","block_edwiserratingreview"),infoEmpty:M.util.get_string("infoEmpty","block_edwiserratingreview"),paginate:{first:M.util.get_string("first","moodle"),previous:M.util.get_string("previous","moodle"),next:M.util.get_string("next","moodle"),last:M.util.get_string("last","moodle")},emptyTable:M.util.get_string("emptytable","block_edwiserratingreview")},columns:[{data:"reviewfor",orderable:!0},{data:"name",orderable:!1},{data:"email",orderable:!1},{data:"ratings",orderable:!1,className:"e-w-75"},{data:"review",orderable:!1},{data:"date"},{data:"action",orderable:!1}],ajax:function(data,callback,settings){const[min,max]=getSelectedDateRange();Ajax.call([{methodname:"block_edwiserratingreview_get_reviews",args:{start:data.start,length:data.length,order:5==data.order[0].column?data.order[0].dir:"desc",mindate:min,maxdate:max,loadonlypending:$(SELECTOR_pendingapproval).is(":checked")},done:function(response){callback(response)},fail:function(response){console.log("failed to load")}}])}});$(SELECTOR_minDate).keypress((function(event){event.preventDefault()})),$(SELECTOR_maxDate).keypress((function(event){event.preventDefault()})),$(SELECTOR_minDate).change((function(){const[min,max]=getSelectedDateRange();min>max&&""!=max&&$(SELECTOR_maxDate).val(min),$(SELECTOR_maxDate).attr("min",min),table.draw()})),$(SELECTOR_maxDate).change((function(){table.draw()})),$(SELECTOR_pendingapproval).on("change",(function(){table.draw()}));var updateapprove=function(reviewid,approvevalue,approveflag){Ajax.call([{methodname:"block_edwiserratingreview_updateapprove",args:{reviewid:reviewid,approvevalue:approvevalue,approveflag:approveflag},done:function(response){console.log(response)},fail:function(response){console.log("failed to load")}}])},approvalmodal=function(bodycontent,titlecontent,approvevalue,approvaflag,buttontext){ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:titlecontent,body:bodycontent}).then((function(modal){modal,modal.setSaveButtonText(buttontext),modal.getRoot().on(ModalEvents.save,(function(){updateapprove(reveiwid,approvevalue,approvaflag),table.draw("page")})),modal.show()}))},bodydata=function(currentbtn){var currentrow=$(currentbtn).closest("tr"),col0=currentrow.find("td:eq(0)").text(),col1=currentrow.find("td:eq(1)").text(),col2=currentrow.find("td:eq(2)").text(),col3=currentrow.find("td:eq(3)").html(),col4=currentrow.find("td:eq(4)").text(),col5=currentrow.find("td:eq(5)").text();return"<p>".concat(col0,"</p><p>").concat(col1,"</p><p>").concat(col2,"</p><p>").concat(col3,"</p><p>").concat(col4,"</p><p>").concat(col5,"</p>")};$(document).on("click",".reviewapprovebtn",(function(){bodycontent=bodydata(this),titlecontent=LANGS[0],reveiwid=$(this).attr("data-id"),buttontext=LANGS[1],approvalmodal(bodycontent,titlecontent,1,!0,buttontext)})),$(document).on("click",".denyapprovemodal",(function(){bodycontent=bodydata(this),titlecontent=LANGS[4],reveiwid=$(this).attr("data-id"),buttontext=LANGS[5],approvalmodal(bodycontent,titlecontent,0,!0,buttontext)})),$(document).on("click",".instantapprove",(function(){updateapprove($(this).attr("data-id"),1,!0),table.draw("page")})),$(document).on("click",".deniedapproval",(function(){updateapprove($(this).attr("data-id"),0,!0),table.draw("page")})),$(document).on("click",".reviewremovebtn",(function(){bodycontent=M.util.get_string("reviewdeletewarning","block_edwiserratingreview"),titlecontent=LANGS[2],reveiwid=$(this).attr("data-id"),buttontext=LANGS[3],approvalmodal(bodycontent,titlecontent,0,!1,buttontext)}))}))}}}));

//# sourceMappingURL=reviewapprover.min.js.map